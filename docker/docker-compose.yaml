version: "3"

x-service: &service
  environment:
    - SHELL=/bin/bash
  volumes:
    - ${HOME}:/root
    - ${PWD}:/src
  working_dir: /root
  ports:
    - 8888:8888
    - 4000:4000
  
services:
  conda:
    <<: *service
    image: continuumio/anaconda3:2020.11
    volumes:
      - ${HOME}/tmp:/root
    entrypoint:
      - jupyter
      - lab
      - --LabApp.token=
      - --ip=0.0.0.0
      - --no-browser
      - --allow-root
  jekyll:
    <<: *service
    image: jekyll/jekyll:pages
    working_dir: /src
    environment:
      JEKYLL_GITHUB_TOKEN: ${JEKYLL_GITHUB_TOKEN}
    entrypoint:
      - jekyll
      - serve
      - --force_polling
      - --livereload
  jupyter:
    <<: *service
    image: jupyter
    build:
      context: ./jupyter
    entrypoint:
      - jupyter
      - lab
      - --LabApp.token=
      - --ip=0.0.0.0
      - --no-browser
      - --allow-root
      - --NotebookApp.allow_origin=https://colab.research.google.com
